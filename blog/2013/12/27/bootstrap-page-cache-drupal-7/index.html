
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Bootstrap Page Cache - Drupal 7 - Vợ Ba Con</title>
  <meta name="author" content="Andy Truong">

  
  <meta name="description" content="Hôm nay, tôi có đụng tới phần cache của cái bộ route trong Drupal 7, nên muốn đi
coi kỹ lại phần bootstrap của Drupal. Bootstrap của Drupal 7 gồm có &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://v3k.net/blog/2013/12/27/bootstrap-page-cache-drupal-7">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Vợ Ba Con" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46722106-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Vợ Ba Con</a></h1>
  
    <h2>Trang nhà của tui nè</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:v3k.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Bootstrap Page Cache - Drupal 7</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-27T16:10:17+07:00" pubdate data-updated="true">Dec 27<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Hôm nay, tôi có đụng tới phần cache của cái bộ route trong Drupal 7, nên muốn đi
coi kỹ lại phần bootstrap của Drupal.</p>

<!-- more -->


<p>Bootstrap của Drupal 7 gồm có các bước sau, tui chỉ copy lại từ phần comment của
hàm drupal_bootstrap() thôi.</p>

<ul>
<li><strong>DRUPAL_BOOTSTRAP_CONFIGURATION</strong>: Initializes configuration.</li>
<li><strong>DRUPAL_BOOTSTRAP_PAGE_CACHE</strong>: Tries to serve a cached page.</li>
<li><strong>DRUPAL_BOOTSTRAP_DATABASE</strong>: Initializes the database layer.</li>
<li><strong>DRUPAL_BOOTSTRAP_VARIABLES</strong>: Initializes the variable system.</li>
<li><strong>DRUPAL_BOOTSTRAP_SESSION</strong>: Initializes session handling.</li>
<li><strong>DRUPAL_BOOTSTRAP_PAGE_HEADER</strong>: Sets up the page header.</li>
<li><strong>DRUPAL_BOOTSTRAP_LANGUAGE</strong>: Finds out the language of the page.</li>
<li><strong>DRUPAL_BOOTSTRAP_FULL</strong>: Fully loads Drupal. Validates and fixes input data.</li>
</ul>


<p>Mấy phần khác tui không quan tâm lắm, tui chỉ quan tâm tới cái bước
DRUPAL_BOOTSTRAP_PAGE_CACHE. Nghĩa là để cho Drupal delivery được nội dung
tới người dùng cuối mà không có đụng tới DB, tui cần phải làm gì. Tui coi tới
coi lui, thì tạm kết luận, cái luồng của nó như sau:</p>

<ul>
<li>_drupal_bootstrap_page_cache()</li>
<li>If variable_get(&lsquo;page_cache_without_database&rsquo;),

<ul>
<li>then $conf[&lsquo;cache&rsquo;] is true. There is no DB bootstrap here.</li>
<li>else, force drupal boots DRUPAL_BOOTSTRAP_DATABASE and DRUPAL_BOOTSTRAP_VARIABLES</li>
</ul>
</li>
<li>If !$conf[&lsquo;cache&rsquo;], no page cache, boot to next step.</li>
<li>If User IP is block, return 403, exit &mdash; drupal_is_denied() only query db if db
connection is available</li>
<li>If user has cookie, or the request is not cachable

<ul>
<li>Then, header has &lsquo;X-Drupal-Cache: MISS&rsquo;</li>
<li>Else, get cached content

<ul>
<li>Cache ID: $base_root . request_uri()</li>
<li>Cache Bin: cache_page</li>
<li>Cachable: Http Method = GET/HEAD, !drupal_is_cli()</li>
<li>Cached data must be array(), has key path, title, …</li>
<li>If $conf[&lsquo;page_cache_invoke_hooks&rsquo;] > invoke hook_boot</li>
<li>Delivery content &mdash; drupal_serve_page_from_cache($cache)</li>
<li>If $conf[&lsquo;page_cache_invoke_hooks&rsquo;] > invoke hook_exit</li>
</ul>
</li>
</ul>
</li>
</ul>


<p>Vậy thôi, hy vọng note này giúp ích gì đó cho người tìm kiếm trên Google.</p>

<p><strong>Vợ Ba Con</strong></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Andy Truong</span></span>

      








  


<time datetime="2013-12-27T16:10:17+07:00" pubdate data-updated="true">Dec 27<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/drupal/'>Drupal</a>, <a class='category' href='/blog/categories/drupal-7/'>Drupal 7</a>, <a class='category' href='/blog/categories/bootstrap/'>bootstrap</a>, <a class='category' href='/blog/categories/cache/'>cache</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://v3k.net/blog/2013/12/27/bootstrap-page-cache-drupal-7/" data-via="thehongtt" data-counturl="http://v3k.net/blog/2013/12/27/bootstrap-page-cache-drupal-7/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/12/27/ban-tin-web-2013-12/" title="Previous Post: Bản tin web 2013 Tháng 12">&laquo; Bản tin web 2013 Tháng 12</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/01/09/ban-tin-web-2014-01/" title="Next Post: Bản tin web 2014 Tháng 01">Bản tin web 2014 Tháng 01 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/01/10/customize-index-dot-php-of-drupal-for-dev-site/">Customize index.php of Drupal for Dev Site</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/09/php-heros/">PHP Heros</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/09/motopress/">Motopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/09/drupal-7-dot-25/">Drupal 7.25</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/09/ban-tin-web-2014-01/">Bản Tin Web 2014 Tháng 01</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/andytruong">@andytruong</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'andytruong',
            count: 1,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/andytruong?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/andytruong">My Delicious Bookmarks &raquo;</a></p>
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/104897008099633860403?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Andy Truong -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'v3knet';
      
        
        var disqus_developer = 1;
        var disqus_identifier = 'http://v3k.net/blog/2013/12/27/bootstrap-page-cache-drupal-7/';
        var disqus_url = 'http://v3k.net/blog/2013/12/27/bootstrap-page-cache-drupal-7/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
